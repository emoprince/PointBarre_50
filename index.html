<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coffee Cart Event Quote Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        html {
            zoom: 0.8; /* 80% zoom out ‚Äî increase/decrease to taste */
            transform-origin: top center;
        }
        body {
            font-family: 'Lato', sans-serif;
            background-color: #F9F7F3;
        }
        /* Hide arrows from number inputs */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-[#F9F7F3]">

    <div id="app-container" class="bg-[#F9F7F3] text-[#1B1B1B]">
        <header class="p-4 text-center">
            <p class="text-base sm:text-lg text-[#1B1B1B]/90">Configurez votre pack et obtenez une estimation instantan√©e.</p>
        </header>
        
        <main class="px-4">
            <!-- Section 1 Title -->
            <div class="w-full lg:w-3/5 px-4">
                <h3 class="text-lg font-semibold text-[#1B1B1B] mb-3 pt-4">1. Vos coordonn√©es</h3>
            </div>
            
            <!-- Flex Container for Form & Sidebar -->
            <div class="flex flex-col lg:flex-row gap-x-4">
                <!-- Left Column: Form -->
                <div class="w-full lg:w-3/5 px-4">
                    <!-- Section 1: Coordonn√©es (Inputs only) -->
                    <div class="pb-4 border-b border-[#1B1B1B]/30">
                        <div class="space-y-4">
                            <div class="grid sm:grid-cols-2 gap-4">
                                <input type="text" name="firstName" placeholder="Pr√©nom" class="form-input" required />
                                <input type="text" name="lastName" placeholder="Nom" class="form-input" required />
                                <input type="email" name="email" placeholder="Adresse email" class="form-input" required />
                                <input type="tel" name="phone" placeholder="Num√©ro (optionnel)" class="form-input" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1" id="person-count-label">Nombre de personnes (max 50 pour le pack de base)</label>
                                <input type="text" inputMode="numeric" pattern="[0-9]*" name="personCount" placeholder="Ex: 25" class="w-full px-3 py-2 bg-transparent border border-[#1B1B1B] focus:ring-2 focus:ring-[#1B1B1B] placeholder:text-[#1B1B1B]/70" />
                                <p id="person-count-error" class="text-red-400 text-xs mt-1 hidden">Le pack de base est limit√© √† 50 personnes. Pour plus, veuillez nous contacter.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 2: Options -->
                    <div class="py-4 border-b border-[#1B1B1B]/30">
                        <h3 class="text-lg font-semibold text-[#1B1B1B] mb-3">2. Options & Suppl√©ments</h3>
                        <div class="space-y-4">
                            <div class="p-3 bg-[#EEEAE4]" id="croissant-selector"></div>
                            <div class="p-3 bg-[#EEEAE4]" id="biscuit-selector"></div>
    
                            <label class="flex items-center space-x-3 p-3 bg-[#EEEAE4] cursor-pointer hover:bg-[#e0dcd5]">
                                <input type="checkbox" name="wantsCustomCups" class="h-5 w-5 border-gray-300 text-[#1B1B1B] focus:ring-[#1B1B1B]"/>
                                <span id="custom-cups-label">Gobelets personnalis√©s (estim√©: 50.00 CHF)</span>
                            </label>
                            <textarea name="customCupsNotes" placeholder="D√©crivez vos besoins pour les gobelets..." class="form-textarea hidden"></textarea>
                            
                            <label class="flex items-center space-x-3 p-3 bg-[#EEEAE4] cursor-pointer hover:bg-[#e0dcd5]">
                                <input type="checkbox" name="wantsCustomDrink" class="h-5 w-5 border-gray-300 text-[#1B1B1B] focus:ring-[#1B1B1B]"/>
                                <span id="custom-drink-label">Boisson personnalis√©e (estim√©: 75.00 CHF)</span>
                            </label>
                            <textarea name="customDrinkNotes" placeholder="D√©crivez vos besoins pour la boisson..." class="form-textarea hidden"></textarea>
    
                            <label class="flex items-center space-x-3 p-3 bg-[#EEEAE4] cursor-pointer hover:bg-[#e0dcd5]">
                                <input type="checkbox" name="wantsMusicAmbiance" class="h-5 w-5 border-gray-300 text-[#1B1B1B] focus:ring-[#1B1B1B]"/>
                                <span id="music-ambiance-label">Ambiance musicale (estim√©: 100.00 CHF)</span>
                            </label>
                            <textarea name="musicAmbianceNotes" placeholder="D√©crivez vos envies musicales (style, playlist...)" class="form-textarea hidden"></textarea>
                        </div>
                    </div>
    
                    <!-- Section 3: Logos -->
                    <div class="pt-4 border-b border-[#1B1B1B]/30">
                        <h3 class="text-lg font-semibold text-[#1B1B1B] mb-3">3. Vos Logos (.png, .jpg)</h3>
                        
                        <label for="logo-upload" class="w-full text-center cursor-pointer flex items-center justify-center gap-2 bg-[#1B1B1B] text-[#EEEAE4] font-bold py-3 px-4 hover:bg-[#1B1B1B]/90 transition-colors duration-300">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            Ajouter des fichiers
                        </label>
                        <input id="logo-upload" type="file" multiple accept=".png,.jpg,.jpeg" class="hidden" />
                    </div>
                     <!-- File list -->
                     <div class="pt-4">
                        <div id="file-list" class="space-y-2"></div>
                        <p class="text-xs text-center text-[#1B1B1B]/70 mt-2">Note: Vous devrez attacher manuellement les fichiers √† l'email.</p>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <div class="w-full lg:w-2/5 bg-[#EEEAE4] p-4 lg:sticky top-4 self-start">
                    <h2 class="text-xl font-bold text-[#1B1B1B] mb-3 border-b-2 border-[#1B1B1B]/30 pb-2">R√©sum√© du devis</h2>
                    <div class="text-xs text-[#1B1B1B]/90 space-y-1 my-3 p-3 bg-[#F9F7F3] border border-[#1B1B1B]/30">
                        <p><strong>Pour √©v√©nements jusqu‚Äô√† 50 personnes</strong></p>
                        <p>Service barista complet de 3h avec caf√©, lait sans lactose ou avoine, logo sur mousse et mat√©riel inclus.</p>
                        <p>Le tarif couvre l‚Äôensemble des frais ‚Äî installation, service, nettoyage et transport dans Lausanne (10 km). Au-del√†, un suppl√©ment est appliqu√© : 0.75 CHF/km aller-retour.</p>
                        <p>üí° Environ 15 CHF/personne ‚Äì id√©al pour petits √©v√©nements ou r√©unions d‚Äôentreprise.</p>
                    </div>
                    <div id="summary-details" class="space-y-2 text-[#1B1B1B] mb-4">
                        <div class="flex justify-between"><span>Pack Base (jusqu'√† 50 pers.)</span> <strong>750.00 CHF</strong></div>
                        <div id="summary-croissants" class="flex justify-between hidden"></div>
                        <div id="summary-biscuits" class="flex justify-between hidden"></div>
                        <div id="summary-custom-cups" class="flex justify-between hidden"></div>
                        <div id="summary-custom-drink" class="flex justify-between hidden"></div>
                        <div id="summary-music-ambiance" class="flex justify-between hidden"></div>
                    </div>
                    <div class="text-center bg-[#1B1B1B] text-[#EEEAE4] p-3">
                        <p class="text-base">Total estim√©</p>
                        <p id="total-price" class="text-3xl sm:text-4xl font-extrabold tracking-tight">750.00 CHF</p>
                    </div>
                    <a id="send-email-link" href="#" class="mt-4 w-full text-center block bg-[#1B1B1B] text-[#EEEAE4] font-bold py-3 px-4 hover:bg-[#1B1B1B]/90 transition-colors duration-300">
                        Envoyer la demande par Email
                    </a>
                    <p class="text-xs text-center text-[#1B1B1B]/70 mt-2">
                        Cela ouvrira votre client de messagerie par d√©faut.
                    </p>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        // --- CONSTANTS ---
        const BASE_PRICE = 750;
        const MAX_PEOPLE_FOR_BASE_PRICE = 50;
        const CROISSANT_PRICE = 1.90;
        const BISCUIT_PACK_PRICE = 14.00;
        const CUSTOM_CUPS_PRICE = 50.00;
        const CUSTOM_DRINK_PRICE = 75.00;
        const MUSIC_AMBIANCE_PRICE = 100.00;
        const OWNER_EMAIL = 'your-email@example.com';

        // --- STATE ---
        const formState = {
            firstName: '', lastName: '', email: '', phone: '',
            personCount: '', croissantCount: '0', biscuitPacks: '0',
            wantsCustomCups: false, customCupsNotes: '',
            wantsCustomDrink: false, customDrinkNotes: '',
            wantsMusicAmbiance: false, musicAmbianceNotes: '',
        };
        let logoFiles = [];

        // --- DOM ELEMENTS ---
        const form = document.getElementById('app-container');
        const inputs = Object.fromEntries(
            Array.from(form.querySelectorAll('input, textarea')).map(el => [el.name, el])
        );
        const totalPriceEl = document.getElementById('total-price');
        const sendEmailLink = document.getElementById('send-email-link');
        const fileInput = document.getElementById('logo-upload');
        const fileListEl = document.getElementById('file-list');
        const personCountErrorEl = document.getElementById('person-count-error');

        const summaryItems = {
            croissants: document.getElementById('summary-croissants'),
            biscuits: document.getElementById('summary-biscuits'),
            customCups: document.getElementById('summary-custom-cups'),
            customDrink: document.getElementById('summary-custom-drink'),
            musicAmbiance: document.getElementById('summary-music-ambiance'),
        };

        // --- HELPER: QUANTITY SELECTOR ---
        function createQuantitySelector(containerId, title, field, max) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <h3 class="text-base font-semibold text-[#1B1B1B] mb-2">${title}</h3>
                <div class="flex items-center justify-center bg-transparent p-2 border-2 border-[#1B1B1B] max-w-xs mx-auto">
                    <button data-action="decrement" class="quantity-btn">-</button>
                    <span class="flex-grow text-center text-lg font-bold text-[#1B1B1B]">0</span>
                    <button data-action="increment" class="quantity-btn">+</button>
                </div>`;

            const valueEl = container.querySelector('span');
            const [decrementBtn, incrementBtn] = container.querySelectorAll('button');

            const updateButtons = (val) => {
                decrementBtn.disabled = val <= 0;
                incrementBtn.disabled = val >= max;
                decrementBtn.classList.toggle('disabled:opacity-50', val <= 0);
                incrementBtn.classList.toggle('disabled:opacity-50', val >= max);
            };

            decrementBtn.addEventListener('click', () => {
                let currentVal = parseInt(formState[field], 10) || 0;
                if (currentVal > 0) {
                    formState[field] = String(currentVal - 1);
                    valueEl.textContent = formState[field];
                    updateButtons(currentVal - 1);
                    updateApp();
                }
            });

            incrementBtn.addEventListener('click', () => {
                let currentVal = parseInt(formState[field], 10) || 0;
                if (currentVal < max) {
                    formState[field] = String(currentVal + 1);
                    valueEl.textContent = formState[field];
                    updateButtons(currentVal + 1);
                    updateApp();
                }
            });
            updateButtons(0);
        }

        // --- CORE FUNCTIONS ---
        function calculateTotalPrice() {
            let total = BASE_PRICE;
            total += (Number(formState.croissantCount) || 0) * CROISSANT_PRICE;
            total += (Number(formState.biscuitPacks) || 0) * BISCUIT_PACK_PRICE;
            if (formState.wantsCustomCups) total += CUSTOM_CUPS_PRICE;
            if (formState.wantsCustomDrink) total += CUSTOM_DRINK_PRICE;
            if (formState.wantsMusicAmbiance) total += MUSIC_AMBIANCE_PRICE;
            return total;
        }

        function updateSummary(total) {
            const updateItem = (el, condition, text, price) => {
                el.classList.toggle('hidden', !condition);
                if (condition) {
                    el.innerHTML = `<span>${text}</span> <strong>+${price.toFixed(2)} CHF</strong>`;
                }
            };

            const croissantCount = Number(formState.croissantCount) || 0;
            const biscuitPacks = Number(formState.biscuitPacks) || 0;
            
            updateItem(summaryItems.croissants, croissantCount > 0, 'Suppl. Croissants', croissantCount * CROISSANT_PRICE);
            updateItem(summaryItems.biscuits, biscuitPacks > 0, 'Suppl. Biscuits', biscuitPacks * BISCUIT_PACK_PRICE);
            updateItem(summaryItems.customCups, formState.wantsCustomCups, 'Suppl. Gobelets Perso.', CUSTOM_CUPS_PRICE);
            updateItem(summaryItems.customDrink, formState.wantsCustomDrink, 'Suppl. Boisson Perso.', CUSTOM_DRINK_PRICE);
            updateItem(summaryItems.musicAmbiance, formState.wantsMusicAmbiance, 'Suppl. Ambiance Musique', MUSIC_AMBIANCE_PRICE);
            
            totalPriceEl.textContent = `${total.toFixed(2)} CHF`;
        }
        
        function createMailtoLink() {
            const subject = encodeURIComponent(`Demande de devis de ${formState.firstName} ${formState.lastName}`);
            let body = `Bonjour,\n\nVoici les d√©tails pour une demande de devis :\n\n`;
            body += `COORDONN√âES :\n`;
            body += `- Pr√©nom : ${formState.firstName}\n- Nom : ${formState.lastName}\n- Email : ${formState.email}\n`;
            body += `- T√©l√©phone : ${formState.phone || 'Non fourni'}\n- Nombre de personnes : ${formState.personCount || 'Non sp√©cifi√©'}\n\n`;
            body += `OPTIONS & SUPPL√âMENTS :\n`;
            body += `- Croissants Acarr√© : ${Number(formState.croissantCount) > 0 ? `${formState.croissantCount} pi√®ce(s)` : 'Non'}\n`;
            body += `- Biscuits personnalis√©s : ${Number(formState.biscuitPacks) > 0 ? `${formState.biscuitPacks} paquet(s)` : 'Non'}\n`;
            body += `- Gobelets personnalis√©s : ${formState.wantsCustomCups ? `Oui (co√ªt estim√© ajout√©)\n  Notes: ${formState.customCupsNotes || 'Aucune'}` : 'Non'}\n`;
            body += `- Boisson personnalis√©e : ${formState.wantsCustomDrink ? `Oui (co√ªt estim√© ajout√©)\n  Notes: ${formState.customDrinkNotes || 'Aucune'}` : 'Non'}\n`;
            body += `- Ambiance musicale : ${formState.wantsMusicAmbiance ? `Oui (co√ªt estim√© ajout√©)\n  Notes: ${formState.musicAmbianceNotes || 'Aucune'}` : 'Non'}\n\n`;

            if (logoFiles.length > 0) {
                body += `LOGOS :\n- ${logoFiles.length} logo(s) seront joints manuellement par le client.\n\n`;
            }
            body += `----------------------------------\n`;
            body += `PRIX ESTIM√â : ${calculateTotalPrice().toFixed(2)} CHF\n`;
            body += `----------------------------------\n\n`;
            body += `Cordialement,\n${formState.firstName}`;

            return `mailto:${OWNER_EMAIL}?subject=${subject}&body=${encodeURIComponent(body)}`;
        }
        
        function renderFileList() {
            fileListEl.innerHTML = '';
            logoFiles.forEach(file => {
                const fileEl = document.createElement('div');
                fileEl.className = 'flex justify-between items-center bg-[#EEEAE4] p-2 text-sm';
                fileEl.innerHTML = `
                    <span>${file.name}</span>
                    <button data-filename="${file.name}" class="text-red-400 hover:text-red-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                    </button>`;
                fileListEl.appendChild(fileEl);
            });
        }

        function updateApp() {
            const total = calculateTotalPrice();
            updateSummary(total);

            // Handle visibility of textareas
            inputs.customCupsNotes.classList.toggle('hidden', !formState.wantsCustomCups);
            inputs.customDrinkNotes.classList.toggle('hidden', !formState.wantsCustomDrink);
            inputs.musicAmbianceNotes.classList.toggle('hidden', !formState.wantsMusicAmbiance);
            
            // Handle person count validation
            const personCount = Number(formState.personCount) || 0;
            const isInvalid = personCount > MAX_PEOPLE_FOR_BASE_PRICE;
            personCountErrorEl.classList.toggle('hidden', !isInvalid);
            inputs.personCount.classList.toggle('border-red-400', isInvalid);
            inputs.personCount.classList.toggle('border-[#1B1B1B]', !isInvalid);
        }

        // --- EVENT LISTENERS ---
        form.addEventListener('input', (e) => {
            const { name, value, type } = e.target;
            if (name && formState.hasOwnProperty(name)) {
                 if (type === 'checkbox') {
                    formState[name] = e.target.checked;
                } else {
                    formState[name] = value;
                }
                updateApp();
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files) {
                logoFiles = [...logoFiles, ...Array.from(e.target.files)];
                renderFileList();
            }
        });
        
        fileListEl.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (button) {
                const filename = button.dataset.filename;
                logoFiles = logoFiles.filter(f => f.name !== filename);
                renderFileList();
            }
        });

        sendEmailLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.href = createMailtoLink();
        });

        // --- INITIALIZATION ---
        document.querySelectorAll('.form-input').forEach(el => el.classList.add('w-full', 'px-3', 'py-2', 'bg-transparent', 'border', 'border-[#1B1B1B]', 'focus:ring-2', 'focus:ring-[#1B1B1B]', 'placeholder:text-[#1B1B1B]/70'));
        document.querySelectorAll('.form-textarea').forEach(el => el.classList.add('w-full', 'mt-2', 'px-3', 'py-2', 'bg-transparent', 'border', 'border-[#1B1B1B]', 'focus:ring-2', 'focus:ring-[#1B1B1B]', 'placeholder:text-[#1B1B1B]/70'));
        document.querySelectorAll('.quantity-btn').forEach(el => el.classList.add('px-4', 'py-2', 'bg-[#1B1B1B]/10', 'text-[#1B1B1B]', 'hover:bg-[#1B1B1B]/20', 'disabled:cursor-not-allowed', 'transition-colors'));

        document.getElementById('custom-cups-label').textContent = `Gobelets personnalis√©s (estim√©: ${CUSTOM_CUPS_PRICE.toFixed(2)} CHF)`;
        document.getElementById('custom-drink-label').textContent = `Boisson personnalis√©e (estim√©: ${CUSTOM_DRINK_PRICE.toFixed(2)} CHF)`;
        document.getElementById('music-ambiance-label').textContent = `Ambiance musicale (estim√©: ${MUSIC_AMBIANCE_PRICE.toFixed(2)} CHF)`;
        document.getElementById('person-count-label').textContent = `Nombre de personnes (max ${MAX_PEOPLE_FOR_BASE_PRICE} pour le pack de base)`;
        
        createQuantitySelector('croissant-selector', `Croissants Acarr√© (${CROISSANT_PRICE.toFixed(2)} CHF / pi√®ce)`, 'croissantCount', 100);
        createQuantitySelector('biscuit-selector', `Paquets de biscuits personnalis√©s (${BISCUIT_PACK_PRICE.toFixed(2)} CHF / paquet)`, 'biscuitPacks', 20);

        updateApp(); // Initial render
    </script>
    <script>
        function sendHeight() {
          const height = document.body.scrollHeight;
          parent.postMessage({ height }, "https://emoprince.github.io");
        }
        
        // Send initial height after load
        window.addEventListener("load", sendHeight);
        
        // Update dynamically if content resizes
        const observer = new ResizeObserver(sendHeight);
        observer.observe(document.body);
    </script>
</body>
</html>